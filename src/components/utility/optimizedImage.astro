---
import type { ImageMetadata } from 'astro';
import { Image } from 'astro:assets';

interface Props {
  image_path: string;
  image_alt: string;
}

const block = Astro.props;
const images = import.meta.glob<{ default: ImageMetadata }>(
  '/src/assets/**/*.{jpeg,jpg,png,gif}',
  { eager: true }
);

const imageSrc = images[block.image_path]?.default;
const src =
  typeof imageSrc === 'string'
    ? imageSrc.replace(/^\./, '/_cloudcannon')
    : imageSrc ?? block.image_path;

if (!src) {
  throw new Error(
    `"${block.image_path}" does not exist in glob: "src/assets/**/*.{jpeg,jpg,png,gif}"`
  );
}
---

<Image
  alt={block.image_alt}
  widths={[320, 500, 640]}
  sizes={`(max-width: 640px) 320px, (max-width: 960px) 500px, (max-width: 1280px) 640px`}
  src={src}
/>
